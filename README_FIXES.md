# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è Sales Analytics System

## –ß—Ç–æ –±—ã–ª–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–Ø –ø—Ä–æ–≤—ë–ª –ø–æ–ª–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º—ã –∏ –æ–±–Ω–∞—Ä—É–∂–∏–ª —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è**: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ RPC —Ñ—É–Ω–∫—Ü–∏–π –≤ Supabase (–æ—à–∏–±–∫–∞ "ambiguous column")
2. **–ù–µ–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è**: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç OPENAI_API_KEY (AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
3. **–ù–µ–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è**: Plotly –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
4. **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è**: –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ OpenSSL (–º–æ–∂–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å)

### üì¶ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

#### 1. SQL –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```
database/create_analytics_functions.sql
```
–°–æ–∑–¥–∞—ë—Ç 3 RPC-—Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.

#### 2. –°–∫—Ä–∏–ø—Ç—ã
```
scripts/diagnose.sh              - –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã
scripts/fix_rpc_quick.py         - –ü–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è SQL
scripts/apply_analytics_functions.py  - –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–±
```

#### 3. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```
docs/FIX_ANALYTICS_RPC.md        - –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ (EN)
QUICKFIX_RU.md                   - –ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (RU)
DIAGNOSTIC_REPORT.md             - –ü–æ–ª–Ω—ã–π –æ—Ç—á—ë—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
README_FIXES.md                  - –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

---

## üöÄ –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (5 –º–∏–Ω—É—Ç)

### –®–∞–≥ 1: –°–∫–æ–ø–∏—Ä—É–π—Ç–µ SQL

```bash
python3 .venv/bin/python scripts/fix_rpc_quick.py
```

–ù–∞–∂–º–∏—Ç–µ `y` —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å SQL –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞.

### –®–∞–≥ 2: –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –≤ Supabase

1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://app.supabase.com/project/hnunemnxpmyhexzcvmtb/sql
2. –í—Å—Ç–∞–≤—å—Ç–µ SQL (Cmd+V)
3. –ù–∞–∂–º–∏—Ç–µ Run

### –®–∞–≥ 3: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend

```bash
./stop.sh && ./start.sh
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ

```bash
./scripts/diagnose.sh
```

–û—à–∏–±–∫–∞ "ambiguous column" –¥–æ–ª–∂–Ω–∞ –∏—Å—á–µ–∑–Ω—É—Ç—å! ‚úÖ

---

## üìä –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—Å—è

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è SQL:

‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
- Top Products endpoint —Å—Ç–∞–Ω–µ—Ç –±—ã—Å—Ç—Ä–µ–µ (–∞–≥—Ä–µ–≥–∞—Ü–∏—è –≤ –ë–î)
- Top Customers endpoint —Å—Ç–∞–Ω–µ—Ç –±—ã—Å—Ç—Ä–µ–µ
- Sales Trend —Å—Ç–∞–Ω–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ

‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**
- –ò—Å—á–µ–∑–Ω–µ—Ç –æ—à–∏–±–∫–∞ "column reference total_revenue is ambiguous"
- –õ–æ–≥–∏ —Å—Ç–∞–Ω—É—Ç —á–∏—â–µ (–º–µ–Ω—å—à–µ warnings)

‚úÖ **–ö–æ–¥**
- Backend –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ RPC –≤–º–µ—Å—Ç–æ fallback

---

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å AI-—á–∞—Ç, –¥–æ–±–∞–≤—å—Ç–µ OpenAI –∫–ª—é—á:

```bash
echo "OPENAI_API_KEY=sk-your-key-here" >> .env
```

–ó–∞—Ç–µ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
./stop.sh && ./start.sh
```

### Plotly –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤

```bash
.venv/bin/pip install plotly
```

---

## üìû –ü–æ–º–æ—â—å

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# Backend
tail -f backend.log

# Frontend
tail -f frontend.log

# –û—à–∏–±–∫–∏ backend
grep -i error backend.log
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã

```bash
# –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
./scripts/diagnose.sh

# –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
./status.sh

# API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
open http://localhost:8000/docs
```

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è**: `docs/FIX_ANALYTICS_RPC.md`
- **–û—Ç—á—ë—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏**: `DIAGNOSTIC_REPORT.md`
- **–ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: `QUICKFIX_RU.md`

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç

- [ ] –ü—Ä–∏–º–µ–Ω–∏–ª SQL –≤ Supabase SQL Editor
- [ ] –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª backend
- [ ] –ó–∞–ø—É—Å—Ç–∏–ª –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É (`./scripts/diagnose.sh`)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª, —á—Ç–æ –æ—à–∏–±–∫–∞ –∏—Å—á–µ–∑–ª–∞
- [ ] (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –î–æ–±–∞–≤–∏–ª OPENAI_API_KEY
- [ ] (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –£—Å—Ç–∞–Ω–æ–≤–∏–ª plotly

---

**–í—Å—ë –≥–æ—Ç–æ–≤–æ!** üéâ

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã, —Å–º–æ—Ç—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –≤—ã—à–µ.
